{% extends 'layout.html' %}
{% block title %}
    MusicSurf
{% endblock %}
{% block body %}
    <div class="mdl-grid">
      <div class="mdl-cell mdl-cell--4-col">
          <form action = "http://127.0.0.1:2000/" class="form-pos" method = post>
              {{ form.hidden_tag() }}
              <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                {% for field in form %}
                    {% if field.type is equalto 'TextField' %}
                        {{ field.label(class_="mdl-textfield__label") }}
                        {{ field(class_="mdl-textfield__input") }}
                    {% elif field.type == 'SubmitField' %}
                    {% endif %}
                    <!-- {{ field.label }}{{ field }} -->
                {% endfor %}


              </div>
               <br/>
              <p>Filters</p>
              {% for field in form %}
                  {% if field.type == 'BooleanField' %}
                    <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="{{ field.name }}">
                        {{ field(class_="mdl-checkbox__input") }}
                        <span class="mdl-checkbox__label">{{ field.name }}</span>
                    </label>
                  {% endif %}
              {% endfor %}


              <!-- <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="checkbox-1">
              <input type="checkbox" id="checkbox-1" class="mdl-checkbox__input" name="title">
              <span class="mdl-checkbox__label">Title</span>
            </label>
             <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="checkbox-2">
              <input type="checkbox" id="checkbox-2" class="mdl-checkbox__input">
              <span class="mdl-checkbox__label">Album</span>
            </label>
            <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="checkbox-3">
              <input type="checkbox" id="checkbox-3" class="mdl-checkbox__input">
              <span class="mdl-checkbox__label">Singer</span>
            </label>
            <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="checkbox-4">
              <input type="checkbox" id="checkbox-4" class="mdl-checkbox__input">
              <span class="mdl-checkbox__label">Lyrics</span>
            </label> -->
          </form>

          
      </div>

      <div class="mdl-cell mdl-cell--8-col">
          <div class="results">
            <!--Download results as Playlist-->
            {% if results %}
                <button class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" style="margin:10px;" id="download">Download results as Playlist</button>
                <!--Proxy Tag for playlist data-->
                <meta id="my_playlist_data" data-playlist="{{ playlist }}">
                <script>
                    // Source: http://thiscouldbebetter.wordpress.com/2012/12/18/loading-editing-and-saving-a-text-file-in-html5-using-javascrip/
                    $("#download").on("click", function() {
                        //console.log("download");
                        function destroyClickedElement(event) {
                        document.body.removeChild(event.target);
                        }
                        var $download = document.createElement("a");
                        var textToWrite = $('#my_playlist_data').data("playlist");
                        console.log(textToWrite)
                        var textFileAsBlob = new Blob([textToWrite], {type: "text/plain"});
                        var fileNameToSaveAs = "playlist.m3u";
                        $download.download = fileNameToSaveAs;
                        if (typeof window.URL === "function") {
                        // Chrome
                        $download.href = window.URL.createObjectURL(textFileAsBlob);
                        } else {
                        // Firefox
                        $download.href = window.URL.createObjectURL(textFileAsBlob);
                        }
                        $download.onclick = destroyClickedElement;
                        $download.style.display = "none";
                        document.body.appendChild($download);
                        $download.click();
                    });
                </script>
            {% endif %}
            <!--Results cards-->
            {% if results %}
                {% for i in results['hits']['hits'] %}
                    <div class="mdl-card mdl-shadow--2dp" style="width: 80%;">
                        <div class="mdl-card__title">
                            <h2 class="mdl-card__title-text">{{ i['_source']['title'] }}</h2>
                        </div>
                        <div class="mdl-card__supporting-text">
                            <b>Album:</b> {{ i['_source']['album'] }}<br>
                            <b>Artist:</b> {{ i['_source']['artist'] }}<br>
                            <b>Year:</b> {{ i['_source']['year'] }}<br>
                            {{ i['_source']['lyrics'][0:200] }}...

                        </div>
                        <div class="mdl-card__actions mdl-card--border">
                            <a target="_blank" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="file:///{{ i['_source']['path'] }}">
                            Play
                            </a>
                        </div>
                    </div><br>
                {% endfor %}
            {% endif %}
        </div>
      </div>
    </div>

{% endblock %}
